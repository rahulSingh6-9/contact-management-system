<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:"Segoe UI",sans-serif;
}

body{
    background:#f4f6fb;
    min-height:100vh;
}

/* ===== HEADER ===== */
header{
    background:linear-gradient(135deg,#2c5364,#203a43);
    padding:15px 25px;
    color:#fff;
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
}

.header-left{
    display:flex;
    align-items:center;
    gap:15px;
}

.profile{
    width:70px;
    height:70px;
    border-radius:50%;
    border:3px solid #fff;
    object-fit:cover;
}

.logout{
    background:#ff4d4d;
    color:#fff;
    border:none;
    padding:8px 16px;
    border-radius:6px;
    cursor:pointer;
    transition:.3s;
}

.logout:hover{
    background:#ff1f1f;
    transform:scale(1.05);
}

/* ===== DASHBOARD ===== */
.dashboard{
    padding:25px;
}

/* ===== INFO CARDS ===== */
.cards{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:18px;
    margin-bottom:20px;
}

.card{
    background:#fff;
    padding:18px;
    border-radius:14px;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
    transition:.3s;
}

.card:hover{
    transform:translateY(-5px);
    box-shadow:0 15px 30px rgba(0,0,0,.15);
}

.card h3{
    font-size:14px;
    color:#777;
}

.card p{
    font-size:26px;
    font-weight:bold;
    margin-top:8px;
    color:#203a43;
}

/* ===== ACTION BAR ===== */
.action-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:12px;
}

.search-box input{
    padding:9px 14px;
    border-radius:8px;
    border:1px solid #ccc;
    outline:none;
    width:260px;
}

.delete-all{
    background:#ff4d4d;
    color:#fff;
    border:none;
    padding:9px 16px;
    border-radius:8px;
    cursor:pointer;
    transition:.3s;
}

.delete-all:hover{
    background:#ff1f1f;
    transform:scale(1.05);
}

/* ===== TABLE ===== */
.table-box{
    background:#fff;
    border-radius:14px;
    overflow-x:auto;
    box-shadow:0 10px 25px rgba(0,0,0,.08);
}

table{
    width:100%;
    border-collapse:collapse;
    min-width:900px;
}

thead{
    background:#203a43;
    color:#fff;
}

th,td{
    padding:12px;
    text-align:center;
}

tbody tr{
    transition:.3s;
}

tbody tr:hover{
    background:#f0f4ff;
}

.no-data{
    text-align:center;
    padding:15px;
    color:#777;
    display:none;
}

/* ===== MOBILE FIX ===== */
@media(max-width:768px){
    .profile{
        width:50px;
        height:50px;
    }

    .cards{
        grid-template-columns:repeat(2,1fr);
    }

    .card{
        padding:14px;
    }

    .card p{
        font-size:20px;
    }

    .dashboard{
        padding:15px;
    }

    .search-box input{
        width:100%;
    }

    .action-bar{
        flex-direction:column;
        align-items:stretch;
    }
}
</style>
</head>

<body>

<header>
    <div class="header-left">
        <img src="/image/rahul.jpeg" class="profile">
        <h2>Welcome, Rahul</h2>
    </div>
    <form method="GET" action="/logout">
        <button class="logout">Logout</button>
    </form>
</header>

<section class="dashboard">

    <!-- INFO CARDS -->
    <div class="cards">
        <div class="card">
            <h3>Total Contacts</h3>
            <p id="totalCount">0</p>
        </div>
        <div class="card">
            <h3>Unread Messages</h3>
            <p id="unreadCount">0</p>
        </div>
        <div class="card">
            <h3>Today's Messages</h3>
            <p id="todayCount">0</p>
        </div>
        <div class="card">
            <h3>Server Status</h3>
            <p>Online</p>
        </div>
    </div>

    <!-- ACTION BAR -->
    <div class="action-bar">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search by name...">
        </div>
        <button class="delete-all" onclick="deleteSelected()">Delete Selected</button>
    </div>

    <!-- TABLE -->
    <div class="table-box">
        <table>
            <thead>
                <tr>
                    <th>Select</th>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Message</th>
                    <th>IP</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="contactTable"></tbody>
        </table>
        <div id="noData" class="no-data">No contacts found</div>
    </div>

</section>

<script>
let contacts = [];

const table = document.getElementById("contactTable");
const totalCount = document.getElementById("totalCount");
const noData = document.getElementById("noData");
const unreadCount = document.getElementById("unreadCount");
const todayCount = document.getElementById("todayCount");

/* =========================
   RENDER TABLE
========================= */
function renderTable(data) {
  table.innerHTML = "";

  if (data.length === 0) {
    noData.style.display = "block";
    totalCount.textContent = 0;
    unreadCount.textContent = 0;
    todayCount.textContent = 0;
    return;
  }

  noData.style.display = "none";

  data.forEach(c => {
    table.innerHTML += `
      <tr>
        <td><input type="checkbox" class="selectBox" value="${c.id}"></td>
        <td>${c.id}</td>
        <td>${c.name}</td>
        <td>${c.phone}</td>
        <td>${c.email}</td>
        <td>${c.msg}</td>
        <td>${c.ip}</td>
        <td>${c.date}</td>
      </tr>
    `;
  });

  totalCount.textContent = data.length;
  updateCounts(data);
}

/* =========================
   UPDATE COUNTS
========================= */
function updateCounts(data) {
  const today = new Date().toISOString().slice(0, 10);

  unreadCount.textContent = 0; // temporarily disabled
  todayCount.textContent = data.filter(c => c.date === today).length;
}

/* =========================
   LOAD CONTACTS
========================= */
async function loadContacts() {
  try {
    const res = await fetch("/api/contacts");
    contacts = await res.json();
    renderTable(contacts);
  } catch (err) {
    console.error("Error loading contacts", err);
  }
}

/* =========================
   SEARCH (BACKEND)
========================= */
document.getElementById("searchInput").addEventListener("input", async e => {
  const value = e.target.value.trim();

  try {
    const res = await fetch(`/api/contacts?search=${value}`);
    const data = await res.json();
    renderTable(data);
  } catch (err) {
    console.error("Search error", err);
  }
});

/* =========================
   DELETE SELECTED
========================= */
async function deleteSelected() {
  const selectedIds = [...document.querySelectorAll(".selectBox:checked")]
    .map(cb => cb.value);

  if (selectedIds.length === 0) {
    alert("Please select at least one contact");
    return;
  }

  if (!confirm("Are you sure you want to delete selected contacts?")) return;

  try {
    await fetch("/api/contacts/delete", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ids: selectedIds })
    });

    loadContacts();
  } catch (err) {
    console.error("Delete error", err);
  }
}

/* =========================
   INITIAL LOAD
========================= */
loadContacts();
</script>



</body>
</html>
